{"ast":null,"code":"import React,{useState,useEffect}from'react';import{BrowserRouter as Router,Routes,Route,Navigate}from'react-router-dom';import Header from'./components/layout/Header.jsx';import Footer from'./components/layout/Footer.jsx';import Home from'./pages/Home.jsx';import Products from'./pages/Products.jsx';import ProductDetail from'./pages/ProductDetail.jsx';import Login from'./pages/Login.jsx';import Register from'./pages/Register.jsx';import Cart from'./pages/Cart.jsx';import Checkout from'./pages/Checkout.jsx';import OrderHistory from'./pages/OrderHistory.jsx';import NotFound from'./pages/NotFound.jsx';import ProtectedRoute from'./components/common/ProtectedRoute.jsx';import{jwtDecode}from'jwt-decode';import{logout,getCart}from'./services/api.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[isAuthenticated,setIsAuthenticated]=useState(false);const[user,setUser]=useState(null);const[cartItemCount,setCartItemCount]=useState(0);useEffect(()=>{// Check if user is logged in on app load\nconst token=localStorage.getItem('token');const userInfo=localStorage.getItem('user');if(token&&userInfo){try{const decodedToken=jwtDecode(token);const currentTime=Date.now()/1000;if(decodedToken.exp>currentTime){setIsAuthenticated(true);setUser(JSON.parse(userInfo));}else{// Token expired\nhandleLogout();}}catch(error){console.error('Invalid token:',error);handleLogout();}}},[]);useEffect(()=>{// Fetch cart count whenever user changes\nif(user!==null&&user!==void 0&&user.id){updateCartCount();}else{setCartItemCount(0);}},[user]);const handleLogin=(token,userData)=>{localStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(userData));setIsAuthenticated(true);setUser(userData);};const handleLogout=async()=>{try{// Call logout API\nawait logout();console.log('Logout API call successful');}catch(error){console.error('Logout error:',error);}finally{// Clean up local storage and state regardless of API response\nlocalStorage.removeItem('token');localStorage.removeItem('user');setIsAuthenticated(false);setUser(null);console.log('Local state cleared');}};const updateCartCount=async()=>{if(user!==null&&user!==void 0&&user.id){try{const response=await getCart(user.id);// Get CartItems from the response\nconst items=response.data.CartItems||[];setCartItemCount(items.length);}catch(error){console.error('Failed to fetch cart count:',error);}}};return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col min-h-screen\",children:[/*#__PURE__*/_jsx(Header,{isAuthenticated:isAuthenticated,onLogout:handleLogout,user:user,cartItemCount:cartItemCount}),/*#__PURE__*/_jsx(\"main\",{className:\"flex-grow\",children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Home,{})}),/*#__PURE__*/_jsx(Route,{path:\"/products\",element:/*#__PURE__*/_jsx(Products,{})}),/*#__PURE__*/_jsx(Route,{path:\"/products/:id\",element:/*#__PURE__*/_jsx(ProductDetail,{updateCartCount:updateCartCount})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",element:isAuthenticated?/*#__PURE__*/_jsx(Navigate,{to:\"/\"}):/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/register\",element:isAuthenticated?/*#__PURE__*/_jsx(Navigate,{to:\"/\"}):/*#__PURE__*/_jsx(Register,{})}),/*#__PURE__*/_jsx(Route,{path:\"/cart\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isAuthenticated:isAuthenticated,children:/*#__PURE__*/_jsx(Cart,{userId:user===null||user===void 0?void 0:user.id,updateCartCount:updateCartCount})})}),/*#__PURE__*/_jsx(Route,{path:\"/checkout\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isAuthenticated:isAuthenticated,children:/*#__PURE__*/_jsx(Checkout,{userId:user===null||user===void 0?void 0:user.id})})}),/*#__PURE__*/_jsx(Route,{path:\"/orders\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isAuthenticated:isAuthenticated,children:/*#__PURE__*/_jsx(OrderHistory,{userId:user===null||user===void 0?void 0:user.id})})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(NotFound,{})})]})}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","Router","Routes","Route","Navigate","Header","Footer","Home","Products","ProductDetail","Login","Register","Cart","Checkout","OrderHistory","NotFound","ProtectedRoute","jwtDecode","logout","getCart","jsx","_jsx","jsxs","_jsxs","App","isAuthenticated","setIsAuthenticated","user","setUser","cartItemCount","setCartItemCount","token","localStorage","getItem","userInfo","decodedToken","currentTime","Date","now","exp","JSON","parse","handleLogout","error","console","id","updateCartCount","handleLogin","userData","setItem","stringify","log","removeItem","response","items","data","CartItems","length","children","className","onLogout","path","element","to","onLogin","userId"],"sources":["C:/Users/Emili/Desktop/Studies/Codecademy/ecommerce-api/client/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\r\nimport Header from './components/layout/Header.jsx';\r\nimport Footer from './components/layout/Footer.jsx';\r\nimport Home from './pages/Home.jsx';\r\nimport Products from './pages/Products.jsx';\r\nimport ProductDetail from './pages/ProductDetail.jsx';\r\nimport Login from './pages/Login.jsx';\r\nimport Register from './pages/Register.jsx';\r\nimport Cart from './pages/Cart.jsx';\r\nimport Checkout from './pages/Checkout.jsx';\r\nimport OrderHistory from './pages/OrderHistory.jsx';\r\nimport NotFound from './pages/NotFound.jsx';\r\nimport ProtectedRoute from './components/common/ProtectedRoute.jsx';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport { logout, getCart } from './services/api.js';\r\n\r\nfunction App() {\r\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n    const [cartItemCount, setCartItemCount] = useState(0);\r\n\r\n    useEffect(() => {\r\n        // Check if user is logged in on app load\r\n        const token = localStorage.getItem('token');\r\n        const userInfo = localStorage.getItem('user');\r\n        \r\n        if (token && userInfo) {\r\n            try {\r\n                const decodedToken = jwtDecode(token);\r\n                const currentTime = Date.now() / 1000;\r\n\r\n                if (decodedToken.exp > currentTime) {\r\n                    setIsAuthenticated(true);\r\n                    setUser(JSON.parse(userInfo));\r\n                } else {\r\n                    // Token expired\r\n                    handleLogout();\r\n                }\r\n            } catch (error) {\r\n                console.error('Invalid token:', error);\r\n                handleLogout();\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Fetch cart count whenever user changes\r\n        if (user?.id) {\r\n            updateCartCount()\r\n        } else {\r\n            setCartItemCount(0);\r\n        }\r\n    }, [user]);\r\n\r\n    const handleLogin = (token, userData) => {\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('user', JSON.stringify(userData));\r\n        setIsAuthenticated(true);\r\n        setUser(userData);\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        try {\r\n            // Call logout API\r\n            await logout();\r\n            console.log('Logout API call successful');\r\n        } catch (error) {\r\n            console.error('Logout error:', error);\r\n        } finally {\r\n            // Clean up local storage and state regardless of API response\r\n            localStorage.removeItem('token');\r\n            localStorage.removeItem('user');\r\n            setIsAuthenticated(false);\r\n            setUser(null);\r\n            console.log('Local state cleared');\r\n        }\r\n    };\r\n\r\n    const updateCartCount = async () => {\r\n        if (user?.id) {\r\n            try {\r\n                const response = await getCart(user.id);\r\n                // Get CartItems from the response\r\n                const items = response.data.CartItems || [];\r\n                setCartItemCount(items.length);\r\n            } catch (error) {\r\n                console.error('Failed to fetch cart count:', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Router>\r\n            <div className=\"flex flex-col min-h-screen\">\r\n                <Header \r\n                    isAuthenticated={isAuthenticated} \r\n                    onLogout={handleLogout} \r\n                    user={user} \r\n                    cartItemCount={cartItemCount}\r\n                />\r\n                <main className=\"flex-grow\">\r\n                    <Routes>\r\n                        <Route path=\"/\" element={<Home />} />\r\n                        <Route path=\"/products\" element={<Products />} />\r\n                        <Route path=\"/products/:id\" element={<ProductDetail updateCartCount={updateCartCount}/>} />\r\n                        <Route\r\n                            path=\"/login\"\r\n                            element={isAuthenticated ? <Navigate to=\"/\" /> : <Login onLogin={handleLogin} />}\r\n                        />\r\n                        <Route\r\n                            path=\"/register\"\r\n                            element={isAuthenticated ? <Navigate to=\"/\" /> : <Register />}\r\n                        />\r\n                        <Route\r\n                            path=\"/cart\"\r\n                            element={\r\n                                <ProtectedRoute isAuthenticated={isAuthenticated}>\r\n                                    <Cart userId={user?.id} updateCartCount={updateCartCount} />\r\n                                </ProtectedRoute>\r\n                            }\r\n                        />\r\n                        <Route\r\n                            path=\"/checkout\"\r\n                            element={\r\n                                <ProtectedRoute isAuthenticated={isAuthenticated}>\r\n                                    <Checkout userId={user?.id} />\r\n                                </ProtectedRoute>\r\n                            }\r\n                        />\r\n                        <Route\r\n                            path=\"/orders\"\r\n                            element={\r\n                                <ProtectedRoute isAuthenticated={isAuthenticated}>\r\n                                    <OrderHistory userId={user?.id} />\r\n                                </ProtectedRoute>\r\n                            }\r\n                        />\r\n                        <Route path=\"*\" element={<NotFound />} />\r\n                    </Routes>\r\n                </main>\r\n                <Footer />\r\n            </div>\r\n        </Router>\r\n    );\r\n}\r\n\r\nexport default App;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,aAAa,GAAI,CAAAC,MAAM,CAAEC,MAAM,CAAEC,KAAK,CAAEC,QAAQ,KAAQ,kBAAkB,CACnF,MAAO,CAAAC,MAAM,KAAM,gCAAgC,CACnD,MAAO,CAAAC,MAAM,KAAM,gCAAgC,CACnD,MAAO,CAAAC,IAAI,KAAM,kBAAkB,CACnC,MAAO,CAAAC,QAAQ,KAAM,sBAAsB,CAC3C,MAAO,CAAAC,aAAa,KAAM,2BAA2B,CACrD,MAAO,CAAAC,KAAK,KAAM,mBAAmB,CACrC,MAAO,CAAAC,QAAQ,KAAM,sBAAsB,CAC3C,MAAO,CAAAC,IAAI,KAAM,kBAAkB,CACnC,MAAO,CAAAC,QAAQ,KAAM,sBAAsB,CAC3C,MAAO,CAAAC,YAAY,KAAM,0BAA0B,CACnD,MAAO,CAAAC,QAAQ,KAAM,sBAAsB,CAC3C,MAAO,CAAAC,cAAc,KAAM,wCAAwC,CACnE,OAASC,SAAS,KAAQ,YAAY,CACtC,OAASC,MAAM,CAAEC,OAAO,KAAQ,mBAAmB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEpD,QAAS,CAAAC,GAAGA,CAAA,CAAG,CACX,KAAM,CAACC,eAAe,CAAEC,kBAAkB,CAAC,CAAG5B,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAAC6B,IAAI,CAAEC,OAAO,CAAC,CAAG9B,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAAC+B,aAAa,CAAEC,gBAAgB,CAAC,CAAGhC,QAAQ,CAAC,CAAC,CAAC,CAErDC,SAAS,CAAC,IAAM,CACZ;AACA,KAAM,CAAAgC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAC,QAAQ,CAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAE7C,GAAIF,KAAK,EAAIG,QAAQ,CAAE,CACnB,GAAI,CACA,KAAM,CAAAC,YAAY,CAAGlB,SAAS,CAACc,KAAK,CAAC,CACrC,KAAM,CAAAK,WAAW,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAG,IAAI,CAErC,GAAIH,YAAY,CAACI,GAAG,CAAGH,WAAW,CAAE,CAChCV,kBAAkB,CAAC,IAAI,CAAC,CACxBE,OAAO,CAACY,IAAI,CAACC,KAAK,CAACP,QAAQ,CAAC,CAAC,CACjC,CAAC,IAAM,CACH;AACAQ,YAAY,CAAC,CAAC,CAClB,CACJ,CAAE,MAAOC,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,gBAAgB,CAAEA,KAAK,CAAC,CACtCD,YAAY,CAAC,CAAC,CAClB,CACJ,CACJ,CAAC,CAAE,EAAE,CAAC,CAEN3C,SAAS,CAAC,IAAM,CACZ;AACA,GAAI4B,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEkB,EAAE,CAAE,CACVC,eAAe,CAAC,CAAC,CACrB,CAAC,IAAM,CACHhB,gBAAgB,CAAC,CAAC,CAAC,CACvB,CACJ,CAAC,CAAE,CAACH,IAAI,CAAC,CAAC,CAEV,KAAM,CAAAoB,WAAW,CAAGA,CAAChB,KAAK,CAAEiB,QAAQ,GAAK,CACrChB,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAElB,KAAK,CAAC,CACpCC,YAAY,CAACiB,OAAO,CAAC,MAAM,CAAET,IAAI,CAACU,SAAS,CAACF,QAAQ,CAAC,CAAC,CACtDtB,kBAAkB,CAAC,IAAI,CAAC,CACxBE,OAAO,CAACoB,QAAQ,CAAC,CACrB,CAAC,CAED,KAAM,CAAAN,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,CACA;AACA,KAAM,CAAAxB,MAAM,CAAC,CAAC,CACd0B,OAAO,CAACO,GAAG,CAAC,4BAA4B,CAAC,CAC7C,CAAE,MAAOR,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,eAAe,CAAEA,KAAK,CAAC,CACzC,CAAC,OAAS,CACN;AACAX,YAAY,CAACoB,UAAU,CAAC,OAAO,CAAC,CAChCpB,YAAY,CAACoB,UAAU,CAAC,MAAM,CAAC,CAC/B1B,kBAAkB,CAAC,KAAK,CAAC,CACzBE,OAAO,CAAC,IAAI,CAAC,CACbgB,OAAO,CAACO,GAAG,CAAC,qBAAqB,CAAC,CACtC,CACJ,CAAC,CAED,KAAM,CAAAL,eAAe,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAInB,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEkB,EAAE,CAAE,CACV,GAAI,CACA,KAAM,CAAAQ,QAAQ,CAAG,KAAM,CAAAlC,OAAO,CAACQ,IAAI,CAACkB,EAAE,CAAC,CACvC;AACA,KAAM,CAAAS,KAAK,CAAGD,QAAQ,CAACE,IAAI,CAACC,SAAS,EAAI,EAAE,CAC3C1B,gBAAgB,CAACwB,KAAK,CAACG,MAAM,CAAC,CAClC,CAAE,MAAOd,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACvD,CACJ,CACJ,CAAC,CAED,mBACItB,IAAA,CAACpB,MAAM,EAAAyD,QAAA,cACHnC,KAAA,QAAKoC,SAAS,CAAC,4BAA4B,CAAAD,QAAA,eACvCrC,IAAA,CAAChB,MAAM,EACHoB,eAAe,CAAEA,eAAgB,CACjCmC,QAAQ,CAAElB,YAAa,CACvBf,IAAI,CAAEA,IAAK,CACXE,aAAa,CAAEA,aAAc,CAChC,CAAC,cACFR,IAAA,SAAMsC,SAAS,CAAC,WAAW,CAAAD,QAAA,cACvBnC,KAAA,CAACrB,MAAM,EAAAwD,QAAA,eACHrC,IAAA,CAAClB,KAAK,EAAC0D,IAAI,CAAC,GAAG,CAACC,OAAO,cAAEzC,IAAA,CAACd,IAAI,GAAE,CAAE,CAAE,CAAC,cACrCc,IAAA,CAAClB,KAAK,EAAC0D,IAAI,CAAC,WAAW,CAACC,OAAO,cAAEzC,IAAA,CAACb,QAAQ,GAAE,CAAE,CAAE,CAAC,cACjDa,IAAA,CAAClB,KAAK,EAAC0D,IAAI,CAAC,eAAe,CAACC,OAAO,cAAEzC,IAAA,CAACZ,aAAa,EAACqC,eAAe,CAAEA,eAAgB,CAAC,CAAE,CAAE,CAAC,cAC3FzB,IAAA,CAAClB,KAAK,EACF0D,IAAI,CAAC,QAAQ,CACbC,OAAO,CAAErC,eAAe,cAAGJ,IAAA,CAACjB,QAAQ,EAAC2D,EAAE,CAAC,GAAG,CAAE,CAAC,cAAG1C,IAAA,CAACX,KAAK,EAACsD,OAAO,CAAEjB,WAAY,CAAE,CAAE,CACpF,CAAC,cACF1B,IAAA,CAAClB,KAAK,EACF0D,IAAI,CAAC,WAAW,CAChBC,OAAO,CAAErC,eAAe,cAAGJ,IAAA,CAACjB,QAAQ,EAAC2D,EAAE,CAAC,GAAG,CAAE,CAAC,cAAG1C,IAAA,CAACV,QAAQ,GAAE,CAAE,CACjE,CAAC,cACFU,IAAA,CAAClB,KAAK,EACF0D,IAAI,CAAC,OAAO,CACZC,OAAO,cACHzC,IAAA,CAACL,cAAc,EAACS,eAAe,CAAEA,eAAgB,CAAAiC,QAAA,cAC7CrC,IAAA,CAACT,IAAI,EAACqD,MAAM,CAAEtC,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEkB,EAAG,CAACC,eAAe,CAAEA,eAAgB,CAAE,CAAC,CAChD,CACnB,CACJ,CAAC,cACFzB,IAAA,CAAClB,KAAK,EACF0D,IAAI,CAAC,WAAW,CAChBC,OAAO,cACHzC,IAAA,CAACL,cAAc,EAACS,eAAe,CAAEA,eAAgB,CAAAiC,QAAA,cAC7CrC,IAAA,CAACR,QAAQ,EAACoD,MAAM,CAAEtC,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEkB,EAAG,CAAE,CAAC,CAClB,CACnB,CACJ,CAAC,cACFxB,IAAA,CAAClB,KAAK,EACF0D,IAAI,CAAC,SAAS,CACdC,OAAO,cACHzC,IAAA,CAACL,cAAc,EAACS,eAAe,CAAEA,eAAgB,CAAAiC,QAAA,cAC7CrC,IAAA,CAACP,YAAY,EAACmD,MAAM,CAAEtC,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEkB,EAAG,CAAE,CAAC,CACtB,CACnB,CACJ,CAAC,cACFxB,IAAA,CAAClB,KAAK,EAAC0D,IAAI,CAAC,GAAG,CAACC,OAAO,cAAEzC,IAAA,CAACN,QAAQ,GAAE,CAAE,CAAE,CAAC,EACrC,CAAC,CACP,CAAC,cACPM,IAAA,CAACf,MAAM,GAAE,CAAC,EACT,CAAC,CACF,CAAC,CAEjB,CAEA,cAAe,CAAAkB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}